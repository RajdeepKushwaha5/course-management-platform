{% extends 'base.html' %}

{% load static %}

{% block meta_robots %}
  <meta name="robots" content="noindex">
{% endblock %}

{% block breadcrumbs %}
<li><a href="{% url 'course' course.slug %}">{{ course.title }}</a></li>
<li><a href="{% url 'homework' course.slug homework.slug %}">{{ homework.title }}</a></li>
{% endblock %}

{% block content %}

<h1 class="mb-4">
  {{ homework.title }} - All Submissions
</h1>

{% if messages %}
  {% for message in messages %}
  {% if 'homework' in message.tags %}
    <div class="alert {{ message.tags }}">
      <p>{{ message }}</p>
    </div>
  {% endif %}
  {% endfor %}
{% endif %}

<div class="card mb-4">
  <div class="card-body">
    <h5 class="card-title">
      <i class="fas fa-info-circle"></i> Total Submissions
    </h5>
    <p class="card-text display-4">{{ submissions_data|length }}</p>
  </div>
</div>

<div class="card">
  <div class="card-header">
    <h5 class="mb-0">
      <i class="fas fa-list"></i> Submissions List
    </h5>
  </div>
  <div class="card-body">
    {% if submissions_data %}
      <div class="table-responsive">
        <table class="table table-striped table-hover">
          <thead>
            <tr>
              <th>Email</th>
              <th>Submitted At</th>
              {% for question in questions %}
              <th>Q{{ forloop.counter }}</th>
              {% endfor %}
              <th>Homework Link</th>
            </tr>
          </thead>
          <tbody>
            {% for item in submissions_data %}
            <tr>
              <td>{{ item.submission.student.email }}</td>
              <td>{{ item.submission.submitted_at|date:"Y-m-d H:i:s" }}</td>
              {% for answer in item.answers %}
              <td>
                {% if answer %}
                  <div style="max-width: 200px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;" title="{{ answer }}">
                    {{ answer }}
                  </div>
                {% else %}
                  <span class="text-muted">-</span>
                {% endif %}
              </td>
              {% endfor %}
              <td>
                {% if item.submission.homework_link %}
                  <a href="{{ item.submission.homework_link }}" target="_blank" rel="noopener noreferrer">
                    <i class="fas fa-external-link-alt"></i> View
                  </a>
                {% else %}
                  <span class="text-muted">-</span>
                {% endif %}
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    {% else %}
      <p class="text-muted">No submissions yet.</p>
    {% endif %}
  </div>
</div>

{% endblock %}
